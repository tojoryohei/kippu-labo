options:
  logging: CLOUD_LOGGING_ONLY

steps:
  - name: 'gcr.io/k8s-skaffold/pack'
    entrypoint: 'pack'
    args:
      - 'build'
      - '${_REGION}-docker.pkg.dev/$PROJECT_ID/cloud-run-source-deploy/${_SERVICE_NAME}/${REPO_NAME}:${COMMIT_SHA}'
      - '--builder=gcr.io/buildpacks/builder:latest'
      - '--path=.'
      - '--publish'

  - name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
    entrypoint: 'gcloud'
    args:
      - 'run'
      - 'deploy'
      - '${_SERVICE_NAME}'
      - '--image=${_REGION}-docker.pkg.dev/$PROJECT_ID/cloud-run-source-deploy/${_SERVICE_NAME}/${REPO_NAME}:${COMMIT_SHA}'
      - '--region=${_REGION}'
      - '--command=npm,start'